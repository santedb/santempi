<div xmlns="http://www.w3.org/1999/xhtml" xmlns:sdb="http://santedb.org/applet"
    ng-controller="MasterDataManagementController">
    <sdb:widget order="200" name="org.santedb.widget.mdm.candidate" headerClass="alert-info" size="Medium" type="Panel"
        context="org.santedb.mdm">
        <sdb:icon>fas fa-clone</sdb:icon>
        <sdb:description lang="en">MDM Candidate Locals</sdb:description>
    </sdb:widget>


    <div class="modal" id="candidateDetailModal" tabindex="1" role="dialog" aria-labelledby="candidateDetailModalTitle">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="candidateDetailModalTitle">
                        <i class="fa fa-fw fa-clone"></i> {{ 'ui.mpi.match.detail.title' | i18n }}
                    </h5>
                    <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">
                            <i class="fa fa-times"></i>
                        </span>
                    </button>
                </div>
                <div class="modal-body" ng-if="!candidateObject">
                    <i class="fas fa-circle-notch fa-spin"></i> {{ 'ui.wait' | i18n }}
                </div>
                <div class="modal-body" ng-if="candidateObject">
                    <div class="card">
                        <div class="card-body">
                                <div><strong>{{ 'ui.mdm.candidate.master' | i18n }}:</strong> {{ scopedObject.name
                                    | name }} / {{ scopedObject.identifier | identifier }} / {{
                                        scopedObject.genderConceptModel | concept }}</div>
                                <div><strong>{{ 'ui.mdm.candidate.local' | i18n }}:</strong> <a ui-sref=".({ id: candidateObject.holder })" target="_blank">{{ candidateObject.holderModel.name
                                    | name }} / {{ candidateObject.holderModel.identifier | identifier }} / {{
                                        candidateObject.holderModel.genderConceptModel | concept }} <sup><i class="fas fa-external-link-alt"></i></sup></a></div>
                                    </div>
                    </div>
                    <div class="accordion" id="matchAccordion">
                        <div class="card" ng-repeat="match in candidateObject.results track by $index">
                            <div class="card-header">
                                <h5 class="card-title mb-0">
                                    <button type="button" class="collapse-indicator btn btn-link p-0" data-toggle="collapse"
                                            data-target="#score{{$index}}" aria-expanded="true">
                                            <i class="fas fa-file"></i> {{ match.configuration }} (<span class="badge" ng-class="{ 'badge-success' : match.classification == 2, 'badge-info' : match.classification == 1, 'badge-dark' : match.classification == 0 }">{{ 'ui.mpi.match.class.' + match.classification | i18n }}</span> - {{ match.strength * 100 | number: 0 }}%)
                                            <i class="fas fa-chevron-right"></i>
                                    </button>
                                </h5>
                            </div>
                            <div class="collapse" ng-class="{'show': $index == 0 }" id="score{{$index}}" data-parent="#matchAccordion">
                                            <!-- #include virtual="~/views/matches/partials/matchTable.html" -->
                            </div>
                        </div>
                    </div>
                    
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" type="button" data-dismiss="modal">
                        <i class="fa fa-times"></i> {{ 'ui.action.close' | i18n }}</button>
                </div>
            </div>
        </div>
    </div>
    <entity-table stateless="true" id="CandidateEntityTable" type="EntityRelationship" watch="'scopedObject.id'"
        search-field="name.component.value"
        default-query="{ 'relationshipType.mnemonic': 'MDM-Duplicate', target : scopedObject.id, _viewModel: 'smpi.reverseRelationship', _noexec: scopedObject.id == undefined }"
        render="{ recordInfo: 'renderEntityInfo', strength: 'renderStrength', createdBy: 'renderCreatedBy' }"
        i18n-prefix="'ui.santedb.widget.mdm.duplicates.'"
        actions="[ { name: 'findDuplicates', action: rematch, demand: '1.3.6.1.4.1.33349.3.1.5.9.2.6.3', className: 'btn-info', icon: 'fas fa-search-plus' } ]"
        item-actions="[ { name: 'detail', hint: 'detail', action: 'matchDetail', demand: '1.3.6.1.4.1.33349.3.1.5.9.2.6.3', className: 'btn-info', icon: 'fa fa-ellipsis-v' }, { name: 'link', hint: 'link', action: 'resolve', demand: '1.3.6.1.4.1.33349.3.1.5.9.2.6.1', className: 'btn-success', icon: 'fa fa-code-branch' }, { name: 'ignore', hint: 'ignore', action: 'ignore', demand: '1.3.6.1.4.1.33349.3.1.5.9.2.6.1', className: 'btn-danger', icon: 'fa fa-times' } ]"
        properties="[ 'recordInfo', 'strength', 'createdBy' ]" />


</div>